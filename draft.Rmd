---
title: Draft code and doc
---

# Let's get location

```r
#| load-pkg
library(pkgfilecache)
library(stringr)
library(dplyr)
library(tidyr)
library(purrr)
library(devtools)
build()
devtools::load_all()
document()
test()

# optional
library(tibble)
```

```r
#| load-pkg
devtools::load_all()
document()
test()
```


```r
#| id: proto-function
list_optional_files()

op <- get_raw_operation_aspe() |> as_tibble()
ref_objective <- get_ref_objective_operation_aspe() |> as_tibble()
ref_protocol <- get_ref_protocol_operation_aspe() |> as_tibble()
op_objective <- get_objective_operation_aspe() |> as_tibble()
sampling_point <- get_sampling_point_aspe() |> as_tibble()
op_description <- get_description_operation_aspe() |> as_tibble()
ref_isolation <- get_ref_isolation_operation_aspe() |> as_tibble()
ref_prospection <- get_ref_prospection_method_operation_aspe() |> as_tibble()
```

```r

op_description <- clean_description_operation_aspe()  |> as_tibble()
# TODO:
# - Move and Document functions
# - Write some tests
# - Do we put it merge it with fish operation data? I think not for now
```


```r
sampling_point |>
  dplyr::filter(is.na(pop_sta_id))
op %>%
  dplyr::filter(is.na(pop_sta_id)) %>%
  select(date, obj_libelle, pro_libelle)

op_objective %<>%
  rename_with(., ~gsub("opo_", "", .x, fixed = TRUE)) %>%
  left_join(ref_objective) %>%
  select(ope_id, obj_libelle)

#We might want to check this more close when we have filtered the sites and
#the operations
op_objective %>%
  group_by(obj_libelle) %>%
  summarise(n = n()) %>%
  arrange(desc(n))
  
```

```r
|# ref-protocol
ti <- op %>%
  left_join(ref_protocol, join_by(ope_pro_id == pro_id))
ti %>%
  group_by(pro_libelle) %>%
  summarise(n = n()) %>%
  arrange(desc(n))
```



```r
op <- clean_operation_aspe() %>%
  as_tibble()

head(op$date)
library(lubridate)

```


```r
#TODO:
#- get the variables right: date, objective, protocols, etc...
#- Change/Translate the variable names
# We might want to remove operation with no objective?
  filter(is.na(obj_libelle))
```


